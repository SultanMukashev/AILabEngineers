# Документация по заданию: Развертывание PostgreSQL и S3-хранилища в Docker Compose с кастомной конфигурацией

## 1. Обзор выполненной работы

В рамках задания я настроил окружение, состоящее из следующих компонентов:

- **PostgreSQL 15** – база данных, запущенная в Docker Compose с заданными переменными окружения, использующая bind-монтирование для хранения данных.
- **MinIO** – S3-хранилище для загрузки файлов.
- **pgAdmin** – GUI для работы с PostgreSQL (запускался вместе с другими сервисами).

Также я разработал Python-скрипты для:
- Подключения к PostgreSQL через **psycopg2** и загрузки данных из CSV-файлов.
- Загрузки файлов в MinIO (с использованием библиотеки **boto3**).

## 2. Краткий конспект изученных технологий

- **Docker и Docker Compose**  
  Основы работы с контейнерами: образы, контейнеры, volume’ы, сети. Использование `docker-compose.yml` для описания нескольких сервисов и управления ими.

- **PostgreSQL**  
  Работа с базой данных, выполнение SQL-скриптов для первичной инициализации, понимание особенностей монтирования volume’ов (bind mounts) и нюансов повторного запуска контейнеров.

- **pgAdmin**  
  Использование GUI для управления PostgreSQL, выполнение SQL-запросов и визуализация данных.

- **MinIO и S3-хранилище**  
  Конфигурация MinIO как альтернативы Amazon S3, работа с бакетами и объектами, базовая настройка через Docker Compose.

- **Python (psycopg2 и boto3)**  
  Написание минимальных скриптов для подключения к PostgreSQL, выполнение SQL-запросов и загрузка данных, а также для загрузки файлов в S3-хранилище.

## 3. Описание шагов выполнения задания

1. **Создание файла `docker-compose.yml`**
   - Описал сервис **postgres** с образом `postgres:15`, установил переменные окружения: `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` и тд.
   - Настроил volume для хранения данных: `./pgdata:/var/lib/postgresql/data`.
   - Примонтировал инициализационный SQL-скрипт (`./init.sql`) через `/docker-entrypoint-initdb.d/init.sql` для первичной настройки базы.
   - Настроил маппинг портов: `"5432:5432"` (Во время начала работы происходила неизвестная ошибка с кодировкой: "UnicodeDecodeError: 'utf-8' codec can't decode byte 0xdd in position 53: invalid continuation byte", оказалась проблемой была запущенная на фоне локальный Postgres на порте 5432).

2. **Запуск контейнеров**
   - Запустил контейнеры командой:
     ```sh
     docker-compose up -d
     ```
   - Проверил запущенные контейнеры с помощью:
     ```sh
     docker ps
     ```

3. **Проблемы с инициализацией**
   - Выяснил, что SQL-скрипты из `/docker-entrypoint-initdb.d/` выполняются только при первом запуске с пустым data volume.
   - При повторном запуске контейнеров данные остаются в `./pgdata`, и init-скрипт не применяется. Для повторной инициализации пришлось вручную удалять содержимое `./pgdata`.

4. **Разработка Python-скриптов**
   - Написал минимальный скрипт на Python для подключения к PostgreSQL с использованием библиотеки **psycopg2**.
   - Создал скрипт `load_postgres.py` для загрузки данных из CSV-файлов в базу.
   - Разработал скрипт `load_to_minio.py` для загрузки файлов в MinIO (с использованием библиотеки **boto3** или MinIO Client).

5. **Проверка работы системы**
   - Подключился к базе через pgAdmin и убедился, что таблицы и данные корректно созданы.
   - Проверил через веб-интерфейс MinIO, что файлы успешно загружены в S3-хранилище.

## 4. Итоговый результат

В результате проделанной работы удалось:

- Развернуть PostgreSQL, MinIO и pgAdmin в одном Docker Compose окружении с кастомными настройками.
- Разобраться с особенностями работы init-скриптов в официальном PostgreSQL Docker образе.
- Написать Python-скрипты для автоматической загрузки данных и файлов.
- Получить рабочую систему, которая демонстрирует интеграцию базы данных и S3-хранилища для дальнейшей разработки.

---

Это задание помогло мне глубже понять работу с Docker Compose, управление persistent volume’ами, а также тонкости инициализации базы данных в контейнере.